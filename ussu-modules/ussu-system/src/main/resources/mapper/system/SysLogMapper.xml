<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ussu.modules.system.mapper.SysLogMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.ussu.modules.system.entity.SysLog">
        <id column="id" property="id" />
        <result column="request_method" property="requestMethod" />
        <result column="request_uri" property="requestUri" />
        <result column="request_params" property="requestParams" />
        <result column="request_time" property="requestTime" />
        <result column="http_status" property="httpStatus" />
        <result column="result_code" property="resultCode" />
        <result column="result_msg" property="resultMsg" />
        <result column="device_name" property="deviceName" />
        <result column="browser_type" property="browserType" />
        <result column="user_agent" property="userAgent" />
        <result column="log_name" property="logName" />
        <result column="create_by" property="createBy" />
        <result column="remote_ip" property="remoteIp" />
        <result column="execute_time" property="executeTime" />
        <result column="exception_info" property="exceptionInfo"/>
        <result column="location_str" property="locationStr"/>
        <result column="location_adcode" property="locationAdcode"/>
    </resultMap>
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, request_method, request_uri, request_params, request_time, http_status, result_code, result_msg, device_name, browser_type, user_agent, log_name, create_by, remote_ip,execute_time,exception_info,location_str,location_adcode
    </sql>

    <!--分组查询统计数量-->
    <select id="queryCountGroupBy" resultType="java.util.Map">
        select
            ${column},
            ifnull(count(id),0) as countid
        from
            sys_log
        group by
            ${column}
            <if test="deptIds!=null">
                ,create_dept_id having create_dept_id in
                <foreach collection="deptIds" item="deptId" open="(" close=")" separator=",">
                    #{deptId}
                </foreach>
            </if>
        order by countid asc
    </select>

</mapper>
